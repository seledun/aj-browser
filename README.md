## The project
The aj-browser archive tools are part of an archival project to backup channels on the https://banned.video website.

The goal of the archive is 1. to archive the contents of the channels available at the site, and 2. make the archived data available and searchable to anyone interested in its content.

### Pre-requisites
Node.js, v24 seems the most stable with Prisma.

### Instructions
1. You need to supply a database file to use the web view, these can be found on bland.video/backups (wip)
2. The store.db file needs to be placed into the prisma folder of the project
3. Run the following commands:
`npm install`
`npx prisma generate`
`npm run build`
`npm run start`

You can now use the webviewer at the URL listed in the command window.

# Database viewer
The database viewer consists of a NextJs project that uses Prisma to communicate with the database. The purpose is the viewer is to support easier navigation of the database file that is generated by the archival tool. 

# Archival tool
The archival tool is used to update the local database with updates from the channel,
it firstly retrieves all videos from the channel to add or update locally stored metadata,
then it downloads the comment threads for all videos that are in the local database. Finally
it retrieves the replies to all comments in the database. 

## Limitations of the archival tool

### Retrieval of comment replies 
The process of retrieving all replies for the channel is unfortunately a very taxing matter since
at the time of writig there is around 100k comments that has atleast 1 reply associated. When the script retrieves comments and its metadata it also receives a number of the associated replies, using this number and comparing to how many replies are stored locally the script can avoid updating these replies.

Example scenario where this assumption does not hold:
1. The archival tool retrieves 3 replies for comment x on day 1
2. The user or channel removes 2 replies for this comment.
3. Users add 2 new replies to this comment thread.

When archiving this comment thread the next iteration this comment thread is skipped since it
already has 3 local replies stored meaning that the 2 new replies are not added to the database.

### Additive and transformative nature of the archive
The archive only adds and updates local information when archiving, this can lead to de-synchronized information compared to the website. This is done intentionally as to still
retain information even if it is removed from the channel, but should be noted if the archive
is used for academic purposes where the context of the comment is important.

## Helpers
These files contain separated logic as the main file was getting really large.
The files are divided into validator.py for validating JSON response data, dbutils.py
containing all that is needed to initialize, query and insert into the database, and
finally, the get_request_bodies file that generate all request bodies that are used 
for the archival project.

### Re-using the script for different channels
As configured this script will fetch metadata for all videos under a single channel
hosted on https://banned.video. In the main.py file there are configurable parameters
at the top of the doucment that can be used to backup other channels.

### Response validation
All JSON responses are validated against a local model. The validation is configured
to be very loose, as all keys and values in the response are not relevant for the
functionality of this script. However, the validation can be tightened if necessary
for different purposes by removing the "extra: ignore" from the configurations. 

### Get request bodies
This file contains the different requests that are made throughout the backup process,
the requests are dynamically generated depending on the parameters (limit, offset, id)